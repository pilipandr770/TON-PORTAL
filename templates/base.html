<!-- file: templates/base.html -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>{{ title or "TON Staking Portal" }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}"/>
</head>
<body>
<header class="site-header">
  <a class="brand" href="{{ url_for('index') }}">
    <img src="{{ url_for('static', filename='img/logo.svg') }}" alt="Logo"/>
    <span>TON Staking Portal</span>
  </a>
  <nav>
    <a href="{{ url_for('how') }}">Wie es funktioniert</a>
    <a href="{{ url_for('faq') }}">FAQ</a>
    <a href="{{ url_for('pools_page') }}">Pools</a>
    <a href="{{ url_for('dashboard') }}">Dashboard</a>
  </nav>
</header>

<main class="container">
  {% block content %}{% endblock %}
</main>

<footer class="site-footer">
  <div>
    <a href="{{ url_for('impressum') }}">Impressum</a> ·
    <a href="{{ url_for('datenschutz') }}">Datenschutzerklärung</a> ·
    <a href="{{ url_for('agb') }}">AGB</a> ·
    <a href="{{ url_for('disclaimer') }}">Disclaimer</a> ·
    <a href="{{ url_for('docs') }}">API Docs</a> ·
    <a href="/version" target="_blank" rel="noopener">Version</a>
  </div>
  <small>© {{ 2025 }} TON Staking Portal — Software-Dienstleistung (keine Verwahrung, keine Finanzberatung).</small>
</footer>

<!-- TonConnect UI (CDN) - з автоматичним fallback -->
<script>
  // Завантажуємо TonConnect UI з fallback
  (function() {
    const cdnUrls = [
      'https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js',
      'https://cdn.jsdelivr.net/npm/@tonconnect/ui@latest/dist/tonconnect-ui.min.js'
    ];
    
    function loadScript(url, callback) {
      const script = document.createElement('script');
      script.src = url;
      script.crossOrigin = 'anonymous';
      script.onload = () => {
        console.log('✅ TonConnect UI loaded from:', url);
        callback(null);
      };
      script.onerror = () => {
        console.warn('❌ Failed to load from:', url);
        callback(new Error('Failed to load ' + url));
      };
      document.head.appendChild(script);
    }
    
    function tryLoadCdn(index) {
      if (index >= cdnUrls.length) {
        console.error('❌ All CDN sources failed to load TonConnect UI');
        alert('TonConnect UI konnte nicht geladen werden.\nBitte laden Sie die Seite neu (F5).');
        return;
      }
      
      loadScript(cdnUrls[index], (error) => {
        if (error) {
          console.warn('Trying next CDN...');
          tryLoadCdn(index + 1);
        } else {
          // Успішно завантажено, тепер завантажуємо наші скрипти
          loadOurScripts();
        }
      });
    }
    
    function loadOurScripts() {
      // Завантажити tonconnect.js
      const script1 = document.createElement('script');
      script1.src = "{{ url_for('static', filename='js/tonconnect.js') }}";
      script1.defer = true;
      document.body.appendChild(script1);
      
      // Завантажити tonconnect-ui-init.js після tonconnect.js
      script1.onload = () => {
        const script2 = document.createElement('script');
        script2.src = "{{ url_for('static', filename='js/tonconnect-ui-init.js') }}";
        script2.defer = true;
        document.body.appendChild(script2);
      };
    }
    
    tryLoadCdn(0);
  })();
</script>

<!-- Cookie consent (простий локальний банер без трекерів) -->
<script src="{{ url_for('static', filename='js/cookie-consent.js') }}"></script>
</body>
</html>
