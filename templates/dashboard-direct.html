<!-- file: templates/dashboard-direct.html -->
{% extends "base.html" %}
{% block content %}
<h1>Dashboard (Direct Connection Mode)</h1>

<div class="card" style="background: #2a1a1a; border: 2px solid #f90;">
  <h3>⚠️ WebSocket Bridge nicht verfügbar</h3>
  <p>TON Bridge Server sind von Ihrem Netzwerk nicht erreichbar. Verwenden Sie <strong>direkte Links</strong> für die Wallet-Verbindung:</p>
</div>

<div class="card">
  <h3>Wallet-Verbindung (Direct Links)</h3>
  
  <p>Wähle deine Wallet für die Verbindung:</p>
  
  <div style="display: grid; gap: 12px; margin-top: 20px;">
    <a href="https://app.tonkeeper.com/ton-connect?v=2&id={{ app_id }}&r={{ return_url }}" 
       class="btn btn-primary" 
       style="display: flex; align-items: center; justify-content: center; padding: 16px;">
      <span style="font-size: 1.2em;">📱 Tonkeeper</span>
    </a>
    
    <a href="https://tonhub.com/ton-connect?v=2&id={{ app_id }}&r={{ return_url }}" 
       class="btn btn-primary"
       style="display: flex; align-items: center; justify-content: center; padding: 16px;">
      <span style="font-size: 1.2em;">🏦 Tonhub</span>
    </a>
    
    <a href="https://t.me/wallet?attach=wallet&startattach=tonconnect_v2_{{ app_id }}_{{ return_url }}" 
       class="btn btn-primary"
       style="display: flex; align-items: center; justify-content: center; padding: 16px;">
      <span style="font-size: 1.2em;">✈️ Telegram Wallet</span>
    </a>
  </div>
  
  <p style="margin-top: 20px; color: #888; font-size: 0.9em;">
    💡 Nach dem Klicken öffnet sich die Wallet-App. Bestätige die Verbindung dort.
  </p>
  
  <div id="tonconnect-ui-button" style="margin-top: 20px;"></div>
  
  <p id="wallet-status" style="margin-top:10px">Noch nicht verbunden.</p>
</div>

<div class="card">
  <h3>Balance</h3>
  <p><strong>Adresse:</strong> <span id="addr">—</span></p>
  <p><strong>Netzwerk:</strong> <span id="net">—</span></p>
  <p><strong>Balance:</strong> <span id="bal">—</span> TON</p>
  <button id="btn-refresh" class="btn btn-secondary" disabled>Aktualisieren</button>
</div>

<div class="card">
  <h3>Stake in Pool</h3>
  <p>Wähle einen Pool aus dem Katalog und gib den Betrag in TON ein. 
     Die Delegation wird ausschließlich in deiner Wallet signiert (wir speichern keine Gelder).</p>

  <div class="stake-form">
    <div class="form-group">
      <label for="pool-select"><strong>Pool</strong></label>
      <select id="pool-select" name="pool">
        <!-- Wird dynamisch geladen -->
      </select>
    </div>

    <div class="form-group">
      <label for="amount"><strong>Betrag (TON)</strong></label>
      <input type="number" id="amount" name="amount" min="1" step="0.01" placeholder="z.B.: 100">
    </div>

    <button id="btn-stake" class="btn btn-primary" disabled>Stake TON</button>
  </div>
</div>

<script>
// Pools für Select laden
fetch('/api/pools')
  .then(r => r.json())
  .then(data => {
    const sel = document.getElementById('pool-select');
    if (data.items && data.items.length > 0) {
      data.items.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.address;
        opt.textContent = `${p.name} (${(p.fee * 100).toFixed(1)}% fee)`;
        sel.appendChild(opt);
      });
    }
  });
</script>
{% endblock %}
