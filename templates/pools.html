<!-- file: templates/pools.html -->
{% extends "base.html" %}
{% block content %}
<h1>TON Pools</h1>
<p>–û–±–µ—Ä—ñ—Ç—å –ø—É–ª –¥–ª—è —Å—Ç–µ–π–∫—ñ–Ω–≥—É. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å <strong>"–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑–ø–µ–∫–∏"</strong> –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –∞—É–¥–∏—Ç—É (–º–µ—Ç–∞–¥–∞–Ω—ñ + –æ–Ω—á–µ–π–Ω-–¥–∞–Ω—ñ).</p>
<p>–£—Å—ñ –¥–µ–ª–µ–≥–∞—Ü—ñ—ó –ø—ñ–¥–ø–∏—Å—É—é—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ —É –≤–∞—à–æ–º—É –≤–ª–∞—Å–Ω–æ–º—É –≥–∞–º–∞–Ω—Ü—ñ. –ú–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∞—à—ñ –∫–æ—à—Ç–∏.</p>

<div id="pools-container">
  <p>‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—É–ª—ñ–≤...</p>
</div>

{% include "partials/pool_security_modal.html" %}

<script>
  async function loadPools() {
    const el = document.getElementById('pools-container');
    el.innerHTML = '<p>‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—É–ª—ñ–≤...</p>';
    try {
      const res = await fetch('/api/pools');
      const data = await res.json();
      if (data.items && Array.isArray(data.items)) {
        console.log('Loaded pools:', data.items.length);
        el.innerHTML = data.items.map(p => {
          const typeBadge = p.type === 'lst' 
            ? '<span class="badge" style="background: #2a1f3a; color: #d084ff;">LST</span>' 
            : '<span class="badge" style="background: #1f3a2a; color: #84ffd0;">Native</span>';
          
          return `
            <div class="card" style="margin:12px 0;">
              <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                  <h3>${p.name} ${typeBadge}</h3>
                  ${p.description ? `<p style="color: #a0a0a0; font-size: 0.9em; margin: 4px 0;">${p.description}</p>` : ''}
                </div>
                <button class="btn btn-secondary" onclick="PoolSec.open('${p.address}')" style="flex-shrink: 0;">
                  üîê –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–µ–∑–ø–µ–∫–∏
                </button>
              </div>
              
              <div style="margin-top: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                <div>
                  <p><strong>–ê–¥—Ä–µ—Å–∞:</strong><br/><code style="font-size: 0.85em; word-break: break-all;">${p.address}</code></p>
                  <p><strong>Fee:</strong> ${(p.fee * 100).toFixed(1)} %</p>
                  <p><strong>Min Stake:</strong> ${p.min_stake_ton} TON</p>
                </div>
                <div>
                  ${p.lst_token ? `<p><strong>LST Token:</strong> ${p.lst_token}</p>` : ''}
                  <p><a href="${p.url}" target="_blank" rel="noopener" class="btn btn-secondary" style="display: inline-block; margin-top: 8px;">üåê –°–∞–π—Ç –ø—É–ª—É ‚Üí</a></p>
                </div>
              </div>
            </div>
          `;
        }).join('');
      } else {
        el.innerHTML = '<p>‚ùå –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø—É–ª–∏.</p>';
      }
    } catch (e) {
      console.error('Error loading pools:', e);
      el.innerHTML = '<p>‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –ø—É–ª—ñ–≤.</p>';
    }
  }
  
  window.addEventListener('DOMContentLoaded', loadPools);
</script>
<script src="{{ url_for('static', filename='js/pool-security.js') }}"></script>
{% endblock %}
