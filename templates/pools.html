<!-- file: templates/pools.html -->
{% extends "base.html" %}
{% block content %}
<h1>TON Pools</h1>
<p>Dies ist ein kuratierter Katalog von Pools. Delegationen werden ausschlie√ülich im eigenen Wallet signiert.</p>

<div id="pools-container">
  <p>Laden...</p>
</div>

<script>
  async function loadPools() {
    console.log('loadPools called');
    const el = document.getElementById('pools-container');
    el.innerHTML = '<p>Laden...</p>';
    try {
      console.log('Fetching /api/pools...');
      const res = await fetch('/api/pools');
      console.log('Response status:', res.status);
      const data = await res.json();
      console.log('Pools data:', data);
      if (data.items && Array.isArray(data.items)) {
        console.log('Found', data.items.length, 'pools');
        el.innerHTML = data.items.map(p => `
          <div class="card" style="margin:12px 0;">
            <h3>${p.name}</h3>
            <p><strong>Adresse:</strong> <code>${p.address}</code></p>
            <p><strong>Fee:</strong> ${(p.fee * 100).toFixed(1)} %</p>
            <p><strong>Min Stake:</strong> ${p.min_stake_ton} TON</p>
            <p><a href="${p.url}" target="_blank" rel="noopener">Pool-Website</a></p>
          </div>
        `).join('');
      } else {
        console.warn('No items array in data:', data);
        el.innerHTML = '<p>Keine Daten.</p>';
      }
    } catch (e) {
      console.error('Error loading pools:', e);
      console.error('Error details:', e.message, e.stack);
      el.innerHTML = '<p>Fehler beim Laden der Pool-Daten: ' + e.message + '</p>';
    }
  }
  console.log('Registering DOMContentLoaded listener for loadPools');
  window.addEventListener('DOMContentLoaded', loadPools);
</script>
{% endblock %}
