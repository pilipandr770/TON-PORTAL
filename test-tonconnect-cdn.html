<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TonConnect Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .status { padding: 20px; margin: 20px 0; border-radius: 8px; }
        .loading { background: #fff3cd; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
        button { padding: 15px 30px; font-size: 16px; cursor: pointer; margin: 10px; }
        #logs { background: #f5f5f5; padding: 15px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîß TonConnect UI Loading Test</h1>
    
    <div id="status" class="status loading">
        Initializing...
    </div>

    <div>
        <button id="testBtn" onclick="testConnection()">Test Connection</button>
        <button onclick="document.getElementById('logs').textContent = ''">Clear Logs</button>
    </div>

    <h3>Console Logs:</h3>
    <div id="logs"></div>

    <!-- TonConnect UI Loader (same as production) -->
    <script>
      const logEl = document.getElementById('logs');
      const statusEl = document.getElementById('status');
      
      function log(msg) {
        const timestamp = new Date().toLocaleTimeString();
        logEl.textContent += `[${timestamp}] ${msg}\n`;
        console.log(msg);
      }
      
      log('Starting TonConnect UI loader...');

      // Load TonConnect UI with fallback
      (function() {
        const cdnUrls = [
          'https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js',
          'https://cdn.jsdelivr.net/npm/@tonconnect/ui@latest/dist/tonconnect-ui.min.js'
        ];
        
        function loadScript(url, callback) {
          log('Attempting to load from: ' + url);
          const script = document.createElement('script');
          script.src = url;
          script.crossOrigin = 'anonymous';
          script.onload = () => {
            log('‚úÖ Successfully loaded from: ' + url);
            callback(null);
          };
          script.onerror = () => {
            log('‚ùå Failed to load from: ' + url);
            callback(new Error('Failed to load ' + url));
          };
          document.head.appendChild(script);
        }
        
        function tryLoadCdn(index) {
          if (index >= cdnUrls.length) {
            log('‚ùå ALL CDN SOURCES FAILED!');
            statusEl.textContent = '‚ùå Failed to load TonConnect UI from all CDN sources';
            statusEl.className = 'status error';
            return;
          }
          
          loadScript(cdnUrls[index], (error) => {
            if (error) {
              log('Trying next CDN...');
              tryLoadCdn(index + 1);
            } else {
              log('‚úÖ TonConnect UI loaded successfully');
              statusEl.textContent = '‚úÖ TonConnect UI loaded successfully';
              statusEl.className = 'status success';
              
              // Check if TonConnectUI is available
              setTimeout(() => {
                if (typeof TonConnectUI !== 'undefined') {
                  log('‚úÖ TonConnectUI class is available');
                  document.getElementById('testBtn').disabled = false;
                } else {
                  log('‚ùå TonConnectUI class NOT available (script loaded but class missing)');
                  statusEl.textContent = '‚ùå Script loaded but TonConnectUI class not found';
                  statusEl.className = 'status error';
                }
              }, 100);
            }
          });
        }
        
        tryLoadCdn(0);
      })();

      async function testConnection() {
        log('=== TESTING CONNECTION ===');
        
        if (typeof TonConnectUI === 'undefined') {
          log('‚ùå TonConnectUI not available');
          alert('TonConnectUI is not loaded!');
          return;
        }

        try {
          log('Creating TonConnectUI instance...');
          const tonConnectUI = new TonConnectUI({
            manifestUrl: 'https://ton-portal.onrender.com/tonconnect-manifest.json'
          });
          
          log('‚úÖ Instance created successfully');
          log('Opening modal...');
          
          await tonConnectUI.openModal();
          log('‚úÖ Modal opened!');
          
        } catch (error) {
          log('‚ùå ERROR: ' + error.message);
          log('Stack: ' + error.stack);
          alert('Error: ' + error.message);
        }
      }
    </script>
</body>
</html>
